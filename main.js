(()=>{"use strict";function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}const e=function(){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this._baseUrl=t.baseUrl,this._headers=t.headers}var n,o;return n=e,(o=[{key:"_sendRequest",value:function(t,e){return fetch("".concat(this._baseUrl).concat(t),e).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))}},{key:"_getUserInfo",value:function(){return this._sendRequest("users/me",{headers:this._headers})}},{key:"_getCards",value:function(){return this._sendRequest("cards",{headers:this._headers})}},{key:"getUserPage",value:function(){return Promise.all([this._getUserInfo(),this._getCards()])}},{key:"patchUserInfo",value:function(t){var e=t.name,n=t.about;return this._sendRequest("users/me",{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e,about:n})})}},{key:"postNewCard",value:function(t){var e=t.name,n=t.link;return this._sendRequest("cards",{method:"POST",headers:this._headers,body:JSON.stringify({name:e,link:n})})}},{key:"deleteCard",value:function(t){return this._sendRequest("cards/".concat(t),{method:"DELETE",headers:this._headers})}},{key:"patchAvatar",value:function(t){return this._sendRequest("users/me/avatar",{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:t})})}},{key:"setLike",value:function(t,e){var n=e?"DELETE":"PUT";return this._sendRequest("cards/".concat(t,"/likes"),{method:n,headers:this._headers})}}])&&t(n.prototype,o),Object.defineProperty(n,"prototype",{writable:!1}),e}();var n=".form",o=".profile__avatar",r=".user-name-input",i=".user-profession-input",a=".card-template",c="popup_opened",s={inputSelector:".form__input",submitButtonSelector:".form__handler",inactiveButtonClass:"form__handler_disabled",inputErrorClass:"form__input_type_error",activeErrorClass:"form__input-error_active",errorSelectorPostfix:"input-error"},u=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document;return e.querySelector(t)},l=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document;return Array.from(e.querySelectorAll(t))};function f(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}const p=function(){function t(e,n,o,r){var i=e._id,a=e.name,c=e.link,s=e.likes,u=e.owner,l=r.handleCardClick,f=r.handleDeleteCardClick,p=r.handleLikeCardClick;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.id=i,this._name=a,this._link=c,this._likes=s,this._owner=u,this._userId=n,this._handleCardClick=l,this._handleDeleteCardClick=f,this._handleLikeCardClick=p,this._templateSelector=o,this._element=this._getTemplate(),this._composition=this._getCardComposition()}var e,n;return e=t,(n=[{key:"_getTemplate",value:function(){return u(".card",u(this._templateSelector).content).cloneNode(!0)}},{key:"_getCardComposition",value:function(){return{photo:u(".card__photo",this._element),title:u(".card__title",this._element),likeCount:u(".card__like-count",this._element),likeButton:u(".card__btn_action_like",this._element),deleteButton:u(".card__btn_action_delete",this._element)}}},{key:"_isOwner",value:function(){return this._owner._id===this._userId}},{key:"_toggleLike",value:function(){this._composition.likeButton.classList.toggle("card__btn_active_like")}},{key:"_setLikes",value:function(t){this._likes=t,this._composition.likeCount.textContent=this._likes.length}},{key:"_setEventListeners",value:function(){var t=this;this._composition.photo.addEventListener("click",(function(e){return t._handleCardClick(e.target.src,e.target.alt)})),this._composition.likeButton.addEventListener("click",(function(){return t._handleLikeCardClick(t)})),this._isOwner()&&this._composition.deleteButton.addEventListener("click",(function(){return t._handleDeleteCardClick(t.id)}))}},{key:"isLiked",value:function(){var t=this;return this._likes.some((function(e){return e._id===t._userId}))}},{key:"renderLikeState",value:function(t){var e=t.likes;this._setLikes(e),this._toggleLike()}},{key:"create",value:function(){return this._setEventListeners(),this._element.id=this.id,this._composition.photo.src=this._link,this._composition.photo.alt=this._name,this._composition.title.textContent=this._name,this._composition.likeCount.textContent=this._likes.length,this._composition.deleteButton.hidden=!this._isOwner(),this.isLiked()&&this._toggleLike(),this._element}}])&&f(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function h(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}const d=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._close=this._close.bind(this),this._closeByEsc=this._closeByEsc.bind(this),this._element=u(e),this._composition=this._getComposition(),this._setEventListeners()}var e,n;return e=t,(n=[{key:"_getComposition",value:function(){return{}}},{key:"_close",value:function(t){t.target.classList.contains(c)&&this.close(),t.target.classList.contains("popup__close")&&this.close()}},{key:"_closeByEsc",value:function(t){"Escape"===t.key&&this.close()}},{key:"_setEventListeners",value:function(){this._element.addEventListener("click",this._close)}},{key:"open",value:function(){this._element.classList.add(c),document.addEventListener("keydown",this._closeByEsc)}},{key:"close",value:function(){this._element.classList.remove(c),document.removeEventListener("keydown",this._closeByEsc)}},{key:"enableLoadingMode",value:function(){this._composition.submit.textContent="Сохранение...",this._composition.submit.disabled=!0}},{key:"disableLoadingMode",value:function(){this._composition.submit.textContent=this._submitButtonText,this._composition.submit.disabled=!1}}])&&h(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function _(t){return _="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_(t)}function m(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function y(){return y="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var o=v(t,e);if(o){var r=Object.getOwnPropertyDescriptor(o,e);return r.get?r.get.call(arguments.length<3?t:n):r.value}},y.apply(this,arguments)}function v(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=k(t)););return t}function b(t,e){return b=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},b(t,e)}function g(t,e){if(e&&("object"===_(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function k(t){return k=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},k(t)}var E=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");Object.defineProperty(t,"prototype",{value:Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),writable:!1}),e&&b(t,e)}(c,t);var e,o,r,i,a=(r=c,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=k(r);if(i){var n=k(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return g(this,t)});function c(t,e,n){var o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,c),(o=a.call(this,t))._handleFormSubmit=e,o._formValidator=n(s,o._composition.form),o._formValidator.enableValidation(),o._submitButtonText=o._composition.submit.textContent,o}return e=c,o=[{key:"_getComposition",value:function(){return{form:u(n,this._element),submit:u(".form__submit-handler",this._element)}}},{key:"_setEventListeners",value:function(){var t=this;this._composition.form.addEventListener("submit",(function(e){e.preventDefault(),t._handleFormSubmit(t._getInputValues())})),y(k(c.prototype),"_setEventListeners",this).call(this)}},{key:"_getInputValues",value:function(){var t={};return l(".form__input",this._composition.form).forEach((function(e){t[e.name]=e.value})),t}},{key:"_setInputValues",value:function(t){var e=this;t&&Object.keys(t).forEach((function(n){u(n,e._composition.form).value=t[n]}))}},{key:"open",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._setInputValues(t),this._formValidator.resetValidation(),y(k(c.prototype),"open",this).call(this)}},{key:"close",value:function(){this._composition.form.reset(),y(k(c.prototype),"close",this).call(this)}}],o&&m(e.prototype,o),Object.defineProperty(e,"prototype",{writable:!1}),c}(d);const w=E;function C(t){return C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},C(t)}function O(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function L(){return L="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var o=j(t,e);if(o){var r=Object.getOwnPropertyDescriptor(o,e);return r.get?r.get.call(arguments.length<3?t:n):r.value}},L.apply(this,arguments)}function j(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=R(t)););return t}function P(t,e){return P=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},P(t,e)}function S(t,e){if(e&&("object"===C(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function R(t){return R=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},R(t)}const I=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");Object.defineProperty(t,"prototype",{value:Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),writable:!1}),e&&P(t,e)}(a,t);var e,n,o,r,i=(o=a,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=R(o);if(r){var n=R(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return S(this,t)});function a(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),i.call(this,t)}return e=a,(n=[{key:"_getComposition",value:function(){return{image:u(".photo__img",this._element),caption:u(".photo__caption",this._element)}}},{key:"open",value:function(t,e){this._composition.image.src=t,this._composition.image.alt=e,this._composition.caption.textContent=e,L(R(a.prototype),"open",this).call(this)}}])&&O(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),a}(d);function B(t){return B="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},B(t)}function T(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function x(){return x="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var o=A(t,e);if(o){var r=Object.getOwnPropertyDescriptor(o,e);return r.get?r.get.call(arguments.length<3?t:n):r.value}},x.apply(this,arguments)}function A(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=V(t)););return t}function U(t,e){return U=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},U(t,e)}function D(t,e){if(e&&("object"===B(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function V(t){return V=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},V(t)}const M=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");Object.defineProperty(t,"prototype",{value:Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),writable:!1}),e&&U(t,e)}(c,t);var e,o,r,i,a=(r=c,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=V(r);if(i){var n=V(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return D(this,t)});function c(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,c),a.call(this,t)}return e=c,(o=[{key:"_getComposition",value:function(){return{form:u(n,this._element)}}},{key:"_handleConfirmSubmit",value:function(t){t.preventDefault(),this._aceptConfirmAction()}},{key:"_setEventListeners",value:function(){var t=this;this._composition.form.addEventListener("submit",(function(e){return t._handleConfirmSubmit(e)})),x(V(c.prototype),"_setEventListeners",this).call(this)}},{key:"setAceptConfirmAction",value:function(t){this._aceptConfirmAction=t}}])&&T(e.prototype,o),Object.defineProperty(e,"prototype",{writable:!1}),c}(d);function q(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}const F=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._renderer=e,this._container=u(n)}var e,n;return e=t,(n=[{key:"_clear",value:function(){this._container.innerHTML=""}},{key:"addItem",value:function(t){this._container.prepend(t)}},{key:"render",value:function(t){var e=this;this._clear(),t.forEach((function(t){return e._container.append(e._renderer(t))}))}}])&&q(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function N(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}const H=function(){function t(e,n,o){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._nameElement=u(e),this._aboutElement=u(n),this._avatarElement=u(o)}var e,n;return e=t,(n=[{key:"getUserInfo",value:function(){return{id:this._id,name:this._name,about:this._about}}},{key:"setUserInfo",value:function(t){var e=t._id,n=t.name,o=t.about,r=t.avatar;this._id=e,this._name=n,this._about=o,this._avatar=r,this._nameElement.textContent=n,this._aboutElement.textContent=o,this._avatarElement.src=r}},{key:"setAvatar",value:function(t){this._avatar=t}}])&&N(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function J(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}const z=function(){function t(e,n){var o,r,i=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),r=function(t,e){var n=u(".".concat(t.id,"-").concat(i._config.errorSelectorPostfix),i._formElement);t.classList.add(i._config.inputErrorClass),n.textContent=e,n.classList.add(i._config.activeErrorClass)},(o="_showInputError")in this?Object.defineProperty(this,o,{value:r,enumerable:!0,configurable:!0,writable:!0}):this[o]=r,this._config=e,this._formElement=n,this._formElementComposition=this._getFormComposition()}var e,n;return e=t,(n=[{key:"_getFormComposition",value:function(){return{inputElements:l(this._config.inputSelector,this._formElement),submitButton:u(this._config.submitButtonSelector,this._formElement)}}},{key:"_hasInvalidInput",value:function(){return this._formElementComposition.inputElements.some((function(t){return!t.validity.valid}))}},{key:"_toggleButtonState",value:function(){this._formElementComposition.submitButton.disabled=this._hasInvalidInput(),this._formElementComposition.submitButton.disabled?this._formElementComposition.submitButton.classList.add(this._config.inactiveButtonClass):this._formElementComposition.submitButton.classList.remove(this._config.inactiveButtonClass)}},{key:"_hideInputError",value:function(t){var e=u(".".concat(t.id,"-").concat(this._config.errorSelectorPostfix),this._formElement);t.classList.remove(this._config.inputErrorClass),e.classList.remove(this._config.activeErrorClass),e.textContent=""}},{key:"_checkInputValid",value:function(t){t.validity.valid?this._hideInputError(t):this._showInputError(t,t.validationMessage)}},{key:"_refreshFormElementState",value:function(){var t=this;this._formElementComposition.inputElements.forEach((function(t){return t.dispatchEvent(new Event("input"))})),this._formElementComposition.inputElements.forEach((function(e){""===e.value&&t._hideInputError(e)}))}},{key:"_setFormElementState",value:function(){var t=this;this._toggleButtonState(),this._formElementComposition.inputElements.forEach((function(e){e.addEventListener("input",(function(){t._checkInputValid(e),t._toggleButtonState()}))}))}},{key:"resetValidation",value:function(){this._refreshFormElementState()}},{key:"enableValidation",value:function(){this._setFormElementState()}}])&&J(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function $(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}function G(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var K=new e({baseUrl:"https://mesto.nomoreparties.co/v1/cohort-34/",headers:{authorization:"e8d66936-78b1-41af-9c0d-88294d055d2e","Content-Type":"application/json"}}),Q=new w(".profile-popup",(function(t){var e;e={name:t[u(r).name],about:t[u(i).name]},Q.enableLoadingMode(),K.patchUserInfo(e).then((function(t){tt.setUserInfo(t),Q.close()})).catch((function(t){return console.log(t)})).finally((function(){return Q.disableLoadingMode()}))}),at),W=new w(".card-popup",(function(t){var e;e={name:t[u(".card-name-input").name],link:t[u(".card-link-input").name]},W.enableLoadingMode(),K.postNewCard(e).then((function(t){et.addItem(ot(t)),W.close()})).catch((function(t){return console.log(t)})).finally((function(){return W.disableLoadingMode()}))}),at),X=new I(".photo-popup"),Y=new M(".confirm-popup"),Z=new w(".avatar-popup",(function(t){var e;e=t[u(".avatar-link-input").name],Z.enableLoadingMode(),K.patchAvatar(e).then((function(t){tt.setAvatar(t.avatar),u(o).src=t.avatar,Z.close()})).catch((function(t){return console.log(t)})).finally((function(){return Z.disableLoadingMode()}))}),at),tt=new H(".profile__title",".profile__subtitle",o),et=new F(ot,".cards");function nt(t,e){X.open(t,e)}function ot(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:nt,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:rt,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:it,i=tt.getUserInfo().id,c={handleCardClick:n,handleDeleteCardClick:o,handleLikeCardClick:r};return new p(t,i,e,c).create()}function rt(t){Y.setAceptConfirmAction((function(){return function(t){K.deleteCard(t).then((function(){document.getElementById("".concat(t)).remove(),Y.close()})).catch((function(t){return console.log(t)}))}(t)})),Y.open()}function it(t){!function(t){K.setLike(t.id,t.isLiked()).then((function(e){t.renderLikeState(e)})).catch((function(t){return console.log(t)}))}(t)}function at(t,e){return new z(t,e)}K.getUserPage().then((function(t){var e,n,o=(n=2,function(t){if(Array.isArray(t))return t}(e=t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var o,r,i=[],a=!0,c=!1;try{for(n=n.call(t);!(a=(o=n.next()).done)&&(i.push(o.value),!e||i.length!==e);a=!0);}catch(t){c=!0,r=t}finally{try{a||null==n.return||n.return()}finally{if(c)throw r}}return i}}(e,n)||function(t,e){if(t){if("string"==typeof t)return $(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?$(t,e):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),r=o[0],i=o[1];tt.setUserInfo(r),et.render(i)})).catch((function(t){return console.log(t)})),u(".profile__btn_action_edit").addEventListener("click",(function(){var t,e=tt.getUserInfo(),n=(G(t={},r,e.name),G(t,i,e.about),t);Q.open(n)})),u(".profile__btn_action_add").addEventListener("click",(function(){W.open()})),u(".profile__btn_action_avatar-edit").addEventListener("click",(function(){Z.open()}))})();